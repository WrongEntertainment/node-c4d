#!/usr/bin/env node

/**
 * Cinema4D commandline Render Utilities
 * Rendering projects via terminal. This is useful for automation...
 *
 * @author: Paul Vollmer
 */

/**
 * Module dependencies.
 */
var program = require('commander');
var pkg = require('../package.json');
var c4d = require('../src/index.js');
var utils = require('../src/utils.js');

/**
 * The cli options.
 */
program
  .version(pkg.version)
  .option('-r, --render [filepath]', c4d.options_render.render.description)
  .option('--frame [from,to,step]', c4d.options_render.frame.description)
  .option('--oimage [imagename]', c4d.options_render.oimage.description)
  .option('--omultipass [imagename]', c4d.options_render.omultipass.description)
  .option('--oformat [imageformat]', c4d.options_render.oformat.description)
  .option('--oresolution [width,height]', c4d.options_render.oresolution.description)
  .option('--threads [threadcnt]', c4d.options_render.threads.description)
  .option('--gui', 'start with user interface')
  .option('--silent', 'silent mode. don\'t output anything')
  .option('--report [filepath]', 'save the CINEMA 4D stdout to a json file. if no filepath is set, write file to the current working directory');
program.on('--help', function() {
  console.log('  Description:');
  console.log('');
  console.log('    '+pkg.description);
  console.log('');
  console.log('  Examples:');
  console.log('');
  console.log('    # render a file');
  console.log('    $ c4d --render /path/to/your/file.c4d');
  console.log('');
  console.log('    # render a file and override the resolution');
  console.log('    $ c4d --render /path/to/your/file.c4d --oresolution 1500,1000');
  console.log('');
  console.log('    # render a file from frame 0 to 100');
  console.log('    $ c4d --render /path/to/your/file.c4d --frame 0,100');
  console.log('');
  console.log('    # render a file and save a report');
  console.log('    $ c4d --render /path/to/your/file.c4d --report');
  console.log('');
});
program.parse(process.argv);

/**
 * If no option are set. print out the help.
 */
if (program.render === undefined) {
  program.help();
}
/**
 * If the render option is set, lets render some nice images.
 */
else {
  if (program.render) {
    /* Add the parameter comming from commander.js to this object */
    var data = {
      filepath: program.render,
      frame: program.frame,
      oimage: program.oimage,
      omultipass: program.omultipass,
      oformat: program.oformat,
      oresolution: program.oresolution,
      threads: program.threads,
      gui: program.gui,
      silent: program.silent,
      report: program.report
    };
    /* Run the CINEMA 4D render */
    c4d.render(data, function(c) {
      //console.log('Ready');
    });
  }
}
